/*
drop table tankType
drop table country
drop table player
drop table tank
drop table playerTank
drop table ach
drop table playerTankAch
drop table playerTankFrag
drop table battle
drop table battleResult
drop table battleAch
drop table battleFrag
drop table json2dbMapping
drop table modTurret
drop table modGun
drop table modTurretGun
drop table modTankGun
drop table modRadio
drop table modTankRadio
*/


/*
SQLite:

Autoincrement
- A column declared INTEGER PRIMARY KEY will autoincrement
- Omitting the autoincrement column in an insert is optional
- SQL Server syntax IDENTITY does not seem to interupt table creation

*/


-------------------------------------------------------------------------------------------------

create table tankType (
	id int primary key,
	name varchar(255),
	shortName varchar(255)
);

-------------------------------------------------------------------------------------------------

create table country (
	id int primary key,
	name varchar(255),
	shortName varchar(255)
);

-------------------------------------------------------------------------------------------------

create table player (
	id int identity(1,1) primary key,
	name varchar(255)
);

create unique index ix_player_name_unique on player(name);

-------------------------------------------------------------------------------------------------

create table tank (
	id int primary key,
	tankTypeId int not null,
	countryId int not null,
	name varchar(255),
	tier int,
	premium int,
	expDmg float,
	expWR float,
	expSpot float,
	expFrags float,
	expDef float,
	--imgPath varchar(255) NULL,
	--smallImgPath varchar(255) NULL,
	--contourImgPath varchar(255) NULL,
	--img image NULL,
	--smallImg image NULL,
	--contourImg image NULL
	foreign key (tankTypeId) references tankType (id),
	foreign key (countryId) references country (id)
);

-------------------------------------------------------------------------------------------------

create table playerTank (
	id int identity(1,1) primary key,
	tankId int not null,
	playerId int not null,
	creationTime datetime NULL,
	updatedTime datetime NULL,
	lastBattleTime datetime NULL,
	has15 int not null default 0,
	battles15 int not null default 0,
	battles8p15 int not null default 0,
	wins15 int not null default 0,
	losses15 int not null default 0,
	survived15 int not null default 0,
	frags15 int not null default 0,
	frags8p15 int not null default 0,
	dmg15 int not null default 0,
	dmgReceived15 int not null default 0,
	assistSpot15 int not null default 0,
	assistTrack15 int not null default 0,
	cap15 int not null default 0,
	def15 int not null default 0,
	spot15 int not null default 0,
	xp15 int not null default 0,
	xp8p15 int not null default 0,
	xpOriginal15 int not null default 0,
	shots15 int not null default 0,
	hits15 int not null default 0,
	heHits15 int not null default 0,
	pierced15 int not null default 0,
	shotsReceived15 int not null default 0,
	piercedReceived15 int not null default 0,
	heHitsReceived15 int not null default 0,
	noDmgShotsReceived15 int not null default 0,
	maxDmg15 int not null default 0,
	maxFrags15 int not null default 0,
	maxXp15 int not null default 0,
	has7 int not null default 0,
	battles7 int not null default 0,
	wins7 int not null default 0,
	losses7 int not null default 0,
	survived7 int not null default 0,
	frags7 int not null default 0,
	frags8p7 int not null default 0,
	dmg7 int not null default 0,
	dmgReceived7 int not null default 0,
	assistSpot7 int not null default 0,
	assistTrack7 int not null default 0,
	cap7 int not null default 0,
	def7 int not null default 0,
	spot7 int not null default 0,
	xp7 int not null default 0,
	xpOriginal7 int not null default 0,
	shots7 int not null default 0,
	hits7 int not null default 0,
	heHits7 int not null default 0,
	pierced7 int not null default 0,
	shotsReceived7 int not null default 0,
	piercedReceived7 int not null default 0,
	heHitsReceived7 int not null default 0,
	noDmgShotsReceived7 int not null default 0,
	maxDmg7 int not null default 0,
	maxFrags7 int not null default 0,
	maxXp7 int not null default 0,
	hasCompany int not null default 0,
	hasClan int not null default 0,
	basedOnVersion int not null default 0,
	battleLifeTime int not null default 0,
	mileage int not null default 0,
	treesCut int not null default 0,
	eqBino int not null default 0,
	eqCoated int not null default 0,
	eqCamo int not null default 0,
	equVent int not null default 0,
	skillRecon int not null default 0,
	skillAwareness int not null default 0,
	skillCamo int not null default 0,
	skillBia int not null default 0,
	premiumCons int not null default 0,
	vehicleCamo int not null default 0,
	battlesCompany int not null default 0,
	battlesClan int not null default 0,
	wn8 int not null default 0,
	eff int not null default 0,
	modRadioId int not null default 0,
	modTurretId int not null default 0,
	modGunId int not null default 0,
	markOfMastery int not null default 0,
	foreign key (tankId) references tank (id),
	foreign key (playerId) references player (id)
);

-------------------------------------------------------------------------------------------------

CREATE TABLE battleResult (
	id int primary key,
	name varchar(50) NOT NULL,
	color varchar(50) NOT NULL,
	victory bit NOT NULL default 0,
	draw bit NOT NULL default 0,
	defeat bit NOT NULL default 0
);

-------------------------------------------------------------------------------------------------

CREATE TABLE battleSurvive (
	id int primary key,
	name varchar(50) NOT NULL,
	color varchar(50) NOT NULL,
	survived bit NOT NULL default 0,
	killed bit NOT NULL default 0
);

-------------------------------------------------------------------------------------------------

-- Removed columns:

create table battle (
	id int IDENTITY(1,1) primary key,
	playerTankId int not null default 0,
	battlesCount int not null default 0,
	battleTime datetime not null default 0,
	battleLifeTime int not null default 0,
	battleResultId int not null,
	victory int not null default 0,
	draw int not null default 0,
	defeat int not null default 0,
	battleSurviveId int not null,
	survived int not null default 0,
	killed int not null default 0,
	frags int not null default 0,
	dmg int not null default 0,
	dmgReceived int not null default 0,
	assistSpot int not null default 0,
	assistTrack int not null default 0,
	cap int not null default 0,
	def int not null default 0,
	shots int not null default 0,
	hits int not null default 0,
	shotsReceived int not null default 0,
	pierced int not null default 0,
	piercedReceived int not null default 0,
	spotted int not null default 0,
	mileage int not null default 0,
	treesCut int not null default 0,
	xp int not null default 0,
	mode15 int not null default 0,
	mode7 int not null default 0,
	modeClan int not null default 0,
	modeCompany int not null default 0,
	wn8 int not null default 0,
	eff int not null default 0,
	wsId int,
	foreign key (playerTankId) references playerTank (id),
	foreign key (battleResultId) references battleResult (id),
	foreign key (battleSurviveId) references battleSurvive (id)
);

-------------------------------------------------------------------------------------------------

create table playerTankFrag (
	playerTankId int not null,
	fraggedTankId int not null,
	fragCount int not null,
	primary key (playerTankId, fraggedTankId),
	foreign key (playerTankId) references playerTank (id),
	foreign key (fraggedTankId) references tank (id)
);

------------------------------------------------------------------------------------------------

create table battleFrag (
	battleId int not null,
	fraggedTankId int not null,
	fragCount int not null,
	primary key (battleId, fraggedTankId),
	foreign key (battleId) references battle (id),
	foreign key (fraggedTankId) references tank (id)
);

-------------------------------------------------------------------------------------------------

create table ach (
	id int identity(1,1) primary key,
	name varchar(50) not null,
	section varchar(50) not null,
	options varchar(2000),
	section_order int not null,
	image varchar(255),
	name_i18n varchar(50),
	type varchar(50),
	ordernum int not null,
	description varchar(255) not null,
	name_i18n1 varchar(50),
	name_i18n2 varchar(50),
	name_i18n3 varchar(50),
	name_i18n4 varchar(50)
	--imgPath VARCHAR(255) NOT NULL DEFAULT 0,
	--img1Path VARCHAR(255) NOT NULL DEFAULT 0,
	--img2Path VARCHAR(255) NOT NULL DEFAULT 0,
	--img3Path VARCHAR(255) NOT NULL DEFAULT 0,
	--img4Path VARCHAR(255) NOT NULL DEFAULT 0,
	--img IMAGE NULL,
	--img1 IMAGE NULL,
	--img2 IMAGE NULL,
	--img3 IMAGE NULL,
	--img4 IMAGE NULL
);

-------------------------------------------------------------------------------------------------

create table playerTankAch (
	playerTankId int not null,
	achId int not null,
	achCount int,
	primary key (playerTankId, achId),
	foreign key (achId) references ach (id),
	foreign key (playerTankId) references playerTank (id)
);

-------------------------------------------------------------------------------------------------

create table battleAch (
	battleId int not null,
	achId int not null,
	achCount int,
	primary key (battleId, achId),
	foreign key (achId) references ach (id),
	foreign key (battleId) references battle (id)
);

-------------------------------------------------------------------------------------------------

-- https://eu.wargaming.net/developers/api_explorer/wot/encyclopedia/tankturrets/?application_id=2a8bf9a1ee36d6125058bf6efd006caf&http_method=GET&run=1

create table modTurret (
	id int primary key,								--moduleId
	tankId int not null,							--tanks[]
	name varchar(255),								--name_i18n
	tier int,										--level
	viewRange int,									--circular_vision_radius
	armorFront int,									--armor_forehead
	armorSides int,									--armor_board
	armorRear int,									--armor_fedd
	foreign key (tankId) references tank (id)
);

-------------------------------------------------------------------------------------------------

--https://eu.wargaming.net/developers/api_explorer/wot/encyclopedia/tankguns/?application_id=2a8bf9a1ee36d6125058bf6efd006caf&http_method=GET&run=1

create table modGun (
	id int primary key,								--module_id
	name varchar(255),								--name_i18n
	tier int,										--level
	dmg1 int,										--damage[0]
	dmg2 int,										--damage[1]
	dmg3 int,										--damage[2]
	pen1 int,										--piercing_power[0]
	pen2 int,										--piercing_power[1]
	pen3 int,										--piercing_power[2]
	fireRate numeric								--rate (missing info on autoload)
);

------------------------------------------------------------------------------------------------

create table modTurretGun (
	turretId int not null,							--turrets[] (gun)
	gunId int not null,								--module_id (gun)
	primary key (turretId, gunId),
	foreign key (turretId) references modTurret (id),
	foreign key (gunId) references modGun (id)
);

------------------------------------------------------------------------------------------------

create table modTankGun (
	tankId int not null,							--tanks[] (gun)
	gunId int not null,								--module_id (gun)
	primary key (tankId, gunId),
	foreign key (tankId) references tank (id),
	foreign key (gunId) references modGun (id)
);

-------------------------------------------------------------------------------------------------

-- https://eu.wargaming.net/developers/api_explorer/wot/encyclopedia/tankradios/?application_id=2a8bf9a1ee36d6125058bf6efd006caf&http_method=GET&run=1

create table modRadio (
	id int primary key,								--module_id
	name varchar(255),								--name_i18n
	tier int,										--level
	signalRange int									--distance
);

------------------------------------------------------------------------------------------------

create table modTankRadio (
	tankId int not null,							--tanks[] (radio)
	radioId int not null,							--module_id (radio)
	primary key (tankId, radioId),
	foreign key (tankId) references tank (id),
	foreign key (radioId) references modRadio (id)
);

-------------------------------------------------------------------------------------------------

create table json2dbMapping (
	Id int identity(1,1) primary key,
	jsonMain varchar(255) null,
	jsonSub varchar(255) null,
	jsonProperty varchar(255) null,
	dbDataType varchar(255) null,
	dbPlayerTank varchar(255) null,
	dbBattle varchar(255) null,
	dbAch varchar(255) null,
	jsonMainSubProperty varchar(255) null
);


-------------------------------------------------------------------------------------------------

create table wsTankId (
  tankId int,
  tankName varchar(100),
  wsTankId int,
  wsCountryId int
);

-------------------------------------------------------------------------------------------------

create table favList (
	id int identity(1,1) primary key,
	name varchar(50) not null,
	position int null
);